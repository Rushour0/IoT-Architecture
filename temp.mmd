flowchart LR

subgraph User Applications
  UA((User Applications))
end

subgraph Backend Server
  BS((Backend Server))
end

subgraph Zigbee Gateway
  ZG((Zigbee Gateway))
end

subgraph Smart Light Bulbs
  SLB1((Smart Light Bulb 1))
  SLB2((Smart Light Bulb 2))
  SLB3((Smart Light Bulb 3))
end

UA -->|Configure parameters| BS
BS -->|Update configuration| ZG
ZG -->|Translate to Zigbee| SLB1
ZG -->|Translate to Zigbee| SLB2
ZG -->|Translate to Zigbee| SLB3

SLB1 -->|Send Zigbee message| ZG
SLB2 -->|Send Zigbee message| ZG
SLB3 -->|Send Zigbee message| ZG

ZG -->|Convert to MQTT| BS
BS -->|Update state| SLB1
BS -->|Update state| SLB2
BS -->|Update state| SLB3

SLB1 -->|State change| ZG
SLB2 -->|State change| ZG
SLB3 -->|State change| ZG

ZG -->|Convert to MQTT| BS
BS -->|Send notification| UA
UA -->|Control and configure| SLB1
UA -->|Control and configure| SLB2
UA -->|Control and configure| SLB3

subgraph IAM System
  IAM((IAM System))
end

BS -->|Manage authentication and authorization| IAM

subgraph Invited Users
  IU1((Invited User 1))
  IU2((Invited User 2))
end

UA -->|Share access| BS
BS -->|Update access permissions| IU1
BS -->|Update access permissions| IU2
BS -->|Send notifications| IU1
BS -->|Send notifications| IU2
IU1 -->|Control and configure| SLB1
IU2 -->|Control and configure| SLB2
IU2 -->|Control and configure| SLB3
